# 模块2作业 微信朋友圈高性能复杂度分析

## 朋友圈业务指标
![](assets/16301589214598.jpg)
    
每天有7.8亿人进入朋友圈,1.2亿人发布朋友圈
```mermaid
graph LR
id1(微信朋友圈高性能复杂度)-->id2(浏览)---假设一天当中高峰期有6个小时,7.8亿*0.8/21600约等于30k,QPS:3w
id1-->id4(点赞/评论)---id5[7.8亿中只有20%用户有点赞,评论行为,7.8亿*0.2/21600约等于7222,TPS:1w]
id1-->id6(发布)---id7[1.2亿*0.8/21600, TPS:5k]
```

## 高性能复杂度分析
![](assets/16301613343075.jpg)

## 整体方案
```mermaid
graph LR
id((朋友圈))-->id2(集群)-->id3(计算高性能)-->id4(任务分配)---id10[多机房]
id3-->id5(任务分解)---无需拆分
id2-->id6(存储高性能)-->id7(任务分配)---多机房
id6-->id8(任务分解)---动态使用单独redis集群和MySQL集群
id8---评论/点赞使用单独redis集群和MySQL集群
```
    
## 整体架构
![](assets/16301666183509.jpg)

## 说明
1. 朋友圈发布,可引入cdn,图片,视频等上传到cdn后,返回url和文字等信息一起保存,由于信息量不复杂,写入MySQL即可,由于并发写入量大,引入kafka,削峰填谷.存储采用最终一致性即可
2. 点赞和评论的写入量高于朋友圈发布量,要求及时性,评论还需要顺序性,采用redis存储,定时写入数据库
3. 浏览朋友圈,QPS比较高,所以直接访问Redis
