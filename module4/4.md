# 设计千万级学生管理系统的考试试卷存储方案
## 1.用户行为建模和性能估算
+ 1000万学生
+ 每门考试的答案20判断题、20选择题、4道大题, 判断,选择题100字以内,大题200字,选择题4个答案,每个答案10个字以内,需要20*(100+4*10) + 20*100 + 4*200 = 5600字, 取6000字, 采用utf-8编码存储, 每个中文3个字节,6000*3=18000字节,取20KB
+ 假设每门学科考试80人，每个学生平均一学期20门课，1000w*20KB/80*20=50GB,取60GB
+ 假设学校的考试都安排在某一个月内, 考试集中在上午4小时和下午4小时, 故每天4门课
+ 试卷内容60GB,20天考完, 每天3GB,考试前1天存入redis
+ 采用学校ID+科目ID+考试ID的方式作为key,假设高校3000所,学校id从0001到3000,4字节, 1000w人,每80人学同一门课,一所院校平均考1000w/80/3000=42门课,放大100倍,课程编号从0000到9999够用,故科目ID 4字节,考试ID取5字节,key长度13字节,1000w*13b/80取1G

## 2. 选择存储系统
1. 请求试卷5万/s,采用Redis Sentinel
2. 每天试卷内容4G,单机就能胜任

## 3. 存储方案设计
### 3.1 Redis数据结构设计
1. 采用String类型存储考试内容
2. Key: 学校ID+科目ID+考试ID
3. Value: 试卷内容json化后存入String中

### 3.2 写流程
1. 教师用key(学校ID+科目ID+考试ID)提前1天上传试卷到Redis
2. Key如果存在,替换Value中内容

### 3.3 读流程
1. 学生登录考试系统,开始考试,用key(学校ID+科目ID+考试ID)读取试卷
2. 一次读取后在本地缓存

### 3.4 服务器数据及性能
采用3台服务器,每台4C/8G
